process ProdTPGParam  = {

# Calo geometry service model
   include "Geometry/CaloEventSetup/data/CaloGeometry.cfi"
   include "Geometry/CaloEventSetup/data/EcalTrigTowerConstituents.cfi"
   include "Geometry/CMSCommonData/data/cmsIdealGeometryXML.cfi"

# ecal mapping
   include "Geometry/EcalMapping/data/EcalMapping.cfi"
   es_source eegeom = EmptyESSource {
     string recordName = "EcalMappingRcd"
     vuint32 firstValid = { 1 }
     bool iovIsRunNotTime = false
   }

# ecal tpg params
   es_module = EcalTrigPrimESProducer {
     untracked string DatabaseFileEB = "TPG_EB.txt_old"
     untracked string DatabaseFileEE = "TPG_EE.txt_old"
   }
   es_source tpparams = EmptyESSource {
     string recordName = "EcalTPParametersRcd"
     vuint32 firstValid = { 1 }
     bool iovIsRunNotTime = false
   }

# Get hardcoded conditions the same used for standard digitization
   include "CalibCalorimetry/EcalTrivialCondModules/data/EcalTrivialCondRetriever.cfi"



#########################

 source = PoolSource {
    untracked vstring fileNames = {'file:/afs/cern.ch/user/p/paganini/w1/CMSSW/MyCode/Geometry/TrigPrim.root'}
 }
 untracked PSet maxEvents = {untracked int32 input = 1}

 module TPGParamProducer = EcalTPGParamBuilder {
  double Et_sat = 120.           # Saturation value of the TPG: Et in GeV
  uint32 sliding = 2             # Parameter used for the FE data format

  uint32 weight_sampleMax = 3    # position of the maximum among the 5 samples used by the TPG amplitude filter 

  string LUT_option = "Linear"   # LUT_option can be: "Identity", "Linear", "EcalResolution"
  double LUT_stochastic = 0.03   # Stochastic term of the ECAL ET resolution (used only if LUT_option="EcalResolution")
  double LUT_noise = 0.150       # noise term (GeV) of the ECAL ET resolution (used only if LUT_option="EcalResolution")
  double LUT_constant = 0.005    # constant term of the ECAL ET resolution (used only if LUT_option="EcalResolution")

  double TTF_lowThreshold = 2.5  # Trigger Tower Flag low threshold in GeV
  double TTF_highThreshold = 5.  # Trigger Tower Flag high threshold in GeV

  string outFileEB = "TPG_EB.txt"
  string outFileEE = "TPG_EE.txt"
 }
 
 path p = { TPGParamProducer }

}
